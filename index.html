<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fiftle</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      background: linear-gradient(160deg, #f8fafc 0%, #eef2ff 50%, #faf5ff 100%);
      display: flex; justify-content: center; padding: 24px 16px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    #app { width: 100%; max-width: 500px; }

    .header { text-align: center; margin-bottom: 20px; }
    .header .emoji { font-size: 36px; margin-bottom: 2px; }
    .header h1 { font-size: 26px; font-weight: 800; color: #1e293b; }
    .header .sub { color: #64748b; font-size: 13px; margin-top: 4px; }
    .header .legend { display: flex; justify-content: center; gap: 14px; margin-top: 6px; font-size: 12px; color: #94a3b8; }

    .stats-bar { display: flex; gap: 8px; margin-bottom: 16px; }
    .stat-card {
      flex: 1; padding: 10px 12px; border-radius: 10px;
      background: rgba(248,250,252,0.8); border: 1px solid #e2e8f0; text-align: center;
    }
    .stat-card .val { font-size: 22px; font-weight: 800; color: #1e293b; font-family: 'JetBrains Mono', monospace; }
    .stat-card .lbl { font-size: 11px; color: #94a3b8; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-card .sub-text { font-size: 11px; color: #a5b4fc; margin-top: 2px; }

    .guess-list { display: flex; flex-direction: column; gap: 6px; max-height: 350px; overflow-y: auto; padding-right: 4px; margin-bottom: 16px; }

    .input-area {
      background: #fff; border-radius: 16px; padding: 20px 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 16px rgba(0,0,0,0.04);
      margin-bottom: 16px;
    }
    .input-area.shake { animation: shake 0.4s ease; }

    .digit-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 14px; }

    .digit-input {
      width: 48px; height: 60px; font-size: 26px; font-weight: 700; text-align: center;
      border: 2px solid #d1d5db; border-radius: 12px; outline: none;
      background: #fff; color: #1e293b; transition: all 0.15s ease;
      font-family: 'JetBrains Mono', monospace;
    }
    .digit-input:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99,102,241,0.15); }
    .digit-input:disabled { background: #f3f4f6; }

    .btn-row { display: flex; gap: 8px; }

    .btn-guess {
      flex: 1; padding: 11px 0; border-radius: 10px; border: none;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #fff; font-size: 15px; font-weight: 700; cursor: pointer;
    }
    .btn-guess:disabled { background: #e2e8f0; color: #94a3b8; cursor: default; }

    .btn-giveup {
      padding: 11px 16px; border-radius: 10px; border: 1px solid #fca5a5;
      background: #fff; color: #dc2626; font-size: 14px; font-weight: 600; cursor: pointer;
    }

    .btn-new {
      padding: 11px 20px; border-radius: 10px; border: 1px solid #e2e8f0;
      background: #fff; color: #64748b; font-size: 15px; font-weight: 600; cursor: pointer;
    }

    .banner {
      padding: 14px 18px; border-radius: 12px; margin-bottom: 14px; text-align: center;
    }
    .banner.win { background: linear-gradient(135deg, #dcfce7, #d1fae5); border: 1px solid #86efac; }
    .banner.lose { background: linear-gradient(135deg, #fee2e2, #fef2f2); border: 1px solid #fca5a5; }
    .banner .banner-emoji { font-size: 26px; margin-bottom: 2px; }
    .banner.win .banner-text { font-weight: 700; font-size: 16px; color: #166534; }
    .banner.lose .banner-text { font-weight: 700; font-size: 16px; color: #991b1b; }
    .banner .banner-sub { font-size: 13px; color: #166534; margin-top: 4px; }

    .guess-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 14px; border-radius: 10px; border: 1px solid #e2e8f0;
      background: rgba(248,250,252,0.8);
    }
    .guess-row.freebie { background: rgba(238,242,255,0.7); border: 1px dashed #a5b4fc; }
    .guess-row.winner { background: linear-gradient(135deg, #dcfce7, #d1fae5); border: 1px solid #86efac; }

    .guess-left { display: flex; align-items: center; gap: 10px; }
    .guess-idx { font-size: 12px; font-weight: 600; width: 28px; font-family: monospace; color: #94a3b8; }
    .guess-row.freebie .guess-idx { color: #818cf8; }

    .guess-digits { display: flex; gap: 4px; }
    .guess-digit {
      width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
      border-radius: 7px; font-weight: 700; font-size: 16px;
      font-family: 'JetBrains Mono', monospace; background: #e2e8f0; color: #1e293b;
    }
    .guess-row.freebie .guess-digit { background: #e0e7ff; }
    .guess-row.winner .guess-digit { background: #bbf7d0; }

    .guess-right { display: flex; gap: 6px; }

    .badge {
      display: inline-flex; align-items: center; gap: 3px; padding: 3px 8px;
      border-radius: 20px; font-size: 13px; font-weight: 600;
    }
    .badge.exact { background: #dcfce7; color: #166534; }
    .badge.misplaced { background: #fff7ed; color: #9a3412; }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <div class="emoji">üî¢</div>
      <h1>Fiftle</h1>
      <div class="sub">5-digit code ‚Äî all unique digits ‚Äî unlimited guesses</div>
      <div class="legend">
        <span>‚úÖ Right number, right place</span>
        <span>„Ä∞Ô∏è Right number, wrong place</span>
      </div>
    </div>

    <div class="stats-bar" id="stats-bar"></div>

    <div class="guess-list" id="guess-list"></div>

    <div class="input-area" id="input-area">
      <div class="digit-row" id="digit-row"></div>
      <div class="btn-row" id="btn-row"></div>
    </div>

    <div id="banner-container"></div>
  </div>

  <script>
    let secret = [];
    let guesses = [];
    let gameOver = false;
    let won = false;
    let completedGames = [];
    let freeGuess = null;

    function generateNumber() {
      const digits = [0,1,2,3,4,5,6,7,8,9];
      const first = digits.splice(Math.floor(Math.random() * 9) + 1, 1)[0];
      const rest = [];
      for (let i = 0; i < 4; i++) {
        const idx = Math.floor(Math.random() * digits.length);
        rest.push(digits.splice(idx, 1)[0]);
      }
      return [first, ...rest];
    }

    function evaluate(sec, guess) {
      let bulls = 0, cows = 0;
      guess.forEach(function(d, i) {
        if (d === sec[i]) bulls++;
        else if (sec.includes(d)) cows++;
      });
      return { exact: bulls, misplaced: cows };
    }

    function renderStats() {
      const total = completedGames.length;
      const avg = total > 0 ? (completedGames.reduce(function(a,b){ return a+b; }, 0) / total).toFixed(1) : "\u2014";
      const best = total > 0 ? Math.min.apply(null, completedGames) : "\u2014";
      let html =
        '<div class="stat-card"><div class="val">' + total + '</div><div class="lbl">Games Won</div></div>' +
        '<div class="stat-card"><div class="val">' + avg + '</div><div class="lbl">Avg Guesses</div></div>' +
        '<div class="stat-card"><div class="val">' + best + '</div><div class="lbl">Best</div></div>';
      if (!gameOver) {
        html += '<div class="stat-card"><div class="val">' + guesses.length + '</div><div class="lbl">Current</div><div class="sub-text">guesses</div></div>';
      }
      document.getElementById("stats-bar").innerHTML = html;
    }

    function renderInputs() {
      const row = document.getElementById("digit-row");
      row.innerHTML = "";
      for (let i = 0; i < 5; i++) {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.inputMode = "numeric";
        inp.maxLength = 1;
        inp.className = "digit-input";
        inp.disabled = gameOver;
        inp.dataset.idx = i;
        inp.addEventListener("input", onDigitInput);
        inp.addEventListener("keydown", onDigitKeyDown);
        row.appendChild(inp);
      }
    }

    function renderButtons() {
      const row = document.getElementById("btn-row");
      let html = "";
      if (!gameOver) {
        html += '<button class="btn-guess" onclick="submitGuess()">Guess</button>';
        if (guesses.length > 0) {
          html += '<button class="btn-giveup" onclick="giveUp()">Give Up</button>';
        }
      } else {
        html += '<button class="btn-guess" disabled>Guess</button>';
        html += '<button class="btn-new" onclick="newGame()">New Game</button>';
      }
      row.innerHTML = html;
    }

    function renderBanner() {
      const container = document.getElementById("banner-container");
      if (!gameOver) { container.innerHTML = ""; return; }
      const total = completedGames.length;
      const avg = total > 0 ? (completedGames.reduce(function(a,b){ return a+b; }, 0) / total).toFixed(1) : null;
      if (won) {
        let sub = "";
        if (total > 1) sub = '<div class="banner-sub">Session average: ' + avg + ' guesses over ' + total + ' game' + (total > 1 ? 's' : '') + '</div>';
        container.innerHTML = '<div class="banner win"><div class="banner-emoji">üéâ</div><div class="banner-text">Cracked it in ' + guesses.length + ' guess' + (guesses.length > 1 ? 'es' : '') + '!</div>' + sub + '</div>';
      } else {
        container.innerHTML = '<div class="banner lose"><div class="banner-emoji">üòî</div><div class="banner-text">The number was ' + secret.join("") + '</div></div>';
      }
    }

    function makeGuessRowHTML(guess, result, index, isFreebie) {
      let cls = "guess-row";
      if (isFreebie) cls += " freebie";
      if (result.exact === 5) cls += " winner";
      const label = isFreebie ? "free" : "#" + index;
      const digitsHTML = guess.map(function(d) { return '<span class="guess-digit">' + d + '</span>'; }).join("");
      return '<div class="' + cls + '">' +
        '<div class="guess-left">' +
          '<span class="guess-idx">' + label + '</span>' +
          '<div class="guess-digits">' + digitsHTML + '</div>' +
        '</div>' +
        '<div class="guess-right">' +
          '<span class="badge exact">‚úÖ ' + result.exact + '</span>' +
          '<span class="badge misplaced">„Ä∞Ô∏è ' + result.misplaced + '</span>' +
        '</div>' +
      '</div>';
    }

    function renderGuessList() {
      const list = document.getElementById("guess-list");
      let html = "";
      if (freeGuess) html += makeGuessRowHTML(freeGuess.guess, freeGuess.result, 0, true);
      guesses.forEach(function(g, i) {
        html += makeGuessRowHTML(g.guess, g.result, i + 1, false);
      });
      list.innerHTML = html;
      list.scrollTop = list.scrollHeight;
    }

    function render() {
      renderStats();
      renderButtons();
      renderBanner();
      renderGuessList();
    }

    function getDigitInputs() { return document.querySelectorAll(".digit-input"); }

    function onDigitInput(e) {
      const inp = e.target;
      const idx = parseInt(inp.dataset.idx);
      inp.value = inp.value.replace(/\D/g, "").slice(-1);
      if (inp.value && idx < 4) getDigitInputs()[idx + 1].focus();
    }

    function onDigitKeyDown(e) {
      const idx = parseInt(e.target.dataset.idx);
      const inputs = getDigitInputs();
      if (e.key === "Backspace" && !e.target.value && idx > 0) inputs[idx - 1].focus();
      if (e.key === "Enter") submitGuess();
      if (e.key === "ArrowLeft" && idx > 0) inputs[idx - 1].focus();
      if (e.key === "ArrowRight" && idx < 4) inputs[idx + 1].focus();
    }

    function clearInputs() {
      getDigitInputs().forEach(function(inp) { inp.value = ""; });
      getDigitInputs()[0].focus();
    }

    function shakeInput() {
      const area = document.getElementById("input-area");
      area.classList.add("shake");
      setTimeout(function() { area.classList.remove("shake"); }, 500);
    }

    function submitGuess() {
      if (gameOver) return;
      const vals = Array.from(getDigitInputs()).map(function(inp) { return inp.value; });
      if (vals.some(function(v) { return v === ""; })) { shakeInput(); return; }
      const guess = vals.map(Number);
      if (new Set(guess).size !== 5) { shakeInput(); return; }

      const result = evaluate(secret, guess);
      guesses.push({ guess: guess, result: result });

      if (result.exact === 5) {
        won = true;
        gameOver = true;
        completedGames.push(guesses.length);
      }

      render();
      if (!gameOver) clearInputs();
    }

    function giveUp() {
      gameOver = true;
      won = false;
      render();
    }

    function newGame() {
      secret = generateNumber();
      guesses = [];
      gameOver = false;
      won = false;
      var fg = generateNumber();
      freeGuess = { guess: fg, result: evaluate(secret, fg) };
      renderInputs();
      render();
      setTimeout(function() { getDigitInputs()[0].focus(); }, 50);
    }

    newGame();
  </script>
</body>
</html>
