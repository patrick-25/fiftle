<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fiftle</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      background: linear-gradient(160deg, #f8fafc 0%, #eef2ff 50%, #faf5ff 100%);
      display: flex; justify-content: center; padding: 24px 16px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    #app { width: 100%; max-width: 500px; }

    .header { text-align: center; margin-bottom: 20px; }
    .header .emoji { font-size: 36px; margin-bottom: 2px; }
    .header h1 { font-size: 26px; font-weight: 800; color: #1e293b; }
    .header .sub { color: #64748b; font-size: 13px; margin-top: 4px; }
    .header .legend { display: flex; justify-content: center; gap: 14px; margin-top: 6px; font-size: 12px; color: #94a3b8; }

    .stats-bar { display: flex; gap: 8px; margin-bottom: 16px; }
    .stat-card {
      flex: 1; padding: 10px 12px; border-radius: 10px;
      background: rgba(248,250,252,0.8); border: 1px solid #e2e8f0; text-align: center;
    }
    .stat-card .val { font-size: 22px; font-weight: 800; color: #1e293b; font-family: 'JetBrains Mono', monospace; }
    .stat-card .lbl { font-size: 11px; color: #94a3b8; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-card .sub-text { font-size: 11px; color: #a5b4fc; margin-top: 2px; }

    .guess-list { display: flex; flex-direction: column; gap: 6px; max-height: 350px; overflow-y: auto; padding-right: 4px; margin-bottom: 16px; }

    .input-area {
      background: #fff; border-radius: 16px; padding: 20px 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 16px rgba(0,0,0,0.04);
      margin-bottom: 16px;
    }
    .input-area.shake { animation: shake 0.4s ease; }

    .digit-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 14px; }

    .digit-input {
      width: 48px; height: 60px; font-size: 26px; font-weight: 700; text-align: center;
      border: 2px solid #d1d5db; border-radius: 12px; outline: none;
      background: #fff; color: #1e293b; transition: all 0.15s ease;
      font-family: 'JetBrains Mono', monospace;
    }
    .digit-input:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99,102,241,0.15); }
    .digit-input:disabled { background: #f3f4f6; }

    .btn-row { display: flex; gap: 8px; }

    .btn-guess {
      flex: 1; padding: 11px 0; border-radius: 10px; border: none;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #fff; font-size: 15px; font-weight: 700; cursor: pointer;
    }
    .btn-guess:disabled { background: #e2e8f0; color: #94a3b8; cursor: default; }

    .btn-giveup {
      padding: 11px 16px; border-radius: 10px; border: 1px solid #fca5a5;
      background: #fff; color: #dc2626; font-size: 14px; font-weight: 600; cursor: pointer;
    }

    .btn-new {
      padding: 11px 20px; border-radius: 10px; border: 1px solid #e2e8f0;
      background: #fff; color: #64748b; font-size: 15px; font-weight: 600; cursor: pointer;
    }

    .btn-share {
      padding: 11px 20px; border-radius: 10px; border: none;
      background: #25D366; color: #fff; font-size: 14px; font-weight: 700; cursor: pointer;
      display: inline-flex; align-items: center; gap: 6px;
    }
    .btn-share:hover { background: #1fb855; }

    .banner {
      padding: 14px 18px; border-radius: 12px; margin-bottom: 14px; text-align: center;
    }
    .banner.win { background: linear-gradient(135deg, #dcfce7, #d1fae5); border: 1px solid #86efac; }
    .banner.lose { background: linear-gradient(135deg, #fee2e2, #fef2f2); border: 1px solid #fca5a5; }
    .banner .banner-emoji { font-size: 26px; margin-bottom: 2px; }
    .banner.win .banner-text { font-weight: 700; font-size: 16px; color: #166534; }
    .banner.lose .banner-text { font-weight: 700; font-size: 16px; color: #991b1b; }
    .banner .banner-sub { font-size: 13px; color: #166534; margin-top: 4px; }
    .banner .banner-actions { display: flex; justify-content: center; gap: 8px; margin-top: 10px; }

    .guess-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 14px; border-radius: 10px; border: 1px solid #e2e8f0;
      background: rgba(248,250,252,0.8);
    }
    .guess-row.freebie { background: rgba(238,242,255,0.7); border: 1px dashed #a5b4fc; }
    .guess-row.winner { background: linear-gradient(135deg, #dcfce7, #d1fae5); border: 1px solid #86efac; }

    .guess-left { display: flex; align-items: center; gap: 10px; }
    .guess-idx { font-size: 12px; font-weight: 600; width: 28px; font-family: monospace; color: #94a3b8; }
    .guess-row.freebie .guess-idx { color: #818cf8; }

    .guess-digits { display: flex; gap: 4px; }
    .guess-digit {
      width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
      border-radius: 7px; font-weight: 700; font-size: 16px;
      font-family: 'JetBrains Mono', monospace; background: #e2e8f0; color: #1e293b;
    }
    .guess-row.freebie .guess-digit { background: #e0e7ff; }
    .guess-row.winner .guess-digit { background: #bbf7d0; }

    .guess-right { display: flex; gap: 6px; }

    .badge {
      display: inline-flex; align-items: center; gap: 3px; padding: 3px 8px;
      border-radius: 20px; font-size: 13px; font-weight: 600;
    }
    .badge.exact { background: #dcfce7; color: #166534; }
    .badge.misplaced { background: #fff7ed; color: #ea580c; }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <div class="emoji">ðŸ”¢</div>
      <h1>Fiftle</h1>
      <div class="sub">Crack the five digit code, digits 0-9, each digit is unique</div>
      <div class="legend">
        <span>âœ… Right number, right place</span>
        <span><svg width="16" height="12" viewBox="0 0 16 12" style="vertical-align: middle;"><path d="M1 6 C3 2, 5 10, 7 6 C9 2, 11 10, 15 6" stroke="#ea580c" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg> Right number, wrong place</span>
      </div>
    </div>

    <div class="stats-bar" id="stats-bar"></div>

    <div class="guess-list" id="guess-list"></div>

    <div class="input-area" id="input-area">
      <div class="digit-row" id="digit-row"></div>
      <div class="btn-row" id="btn-row"></div>
    </div>

    <div id="banner-container"></div>
  </div>

  <script>
    var secret = [];
    var guesses = [];
    var gameOver = false;
    var won = false;
    var completedGames = [];
    var freeGuess = null;

    var SQUIGGLE_SVG = '<svg width="16" height="12" viewBox="0 0 16 12" style="vertical-align: middle; margin-right: 2px;"><path d="M1 6 C3 2, 5 10, 7 6 C9 2, 11 10, 15 6" stroke="#ea580c" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>';

    function getTodayKey() {
      var d = new Date();
      return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
    }

    function loadDailyFreeGuess() {
      try {
        var stored = localStorage.getItem('fiftle_free_guess');
        if (stored) {
          var data = JSON.parse(stored);
          if (data.date === getTodayKey()) {
            return { guess: data.guess, used: true };
          }
        }
      } catch(e) {}
      return { guess: null, used: false };
    }

    function saveDailyFreeGuess(guessDigits) {
      try {
        localStorage.setItem('fiftle_free_guess', JSON.stringify({
          date: getTodayKey(),
          guess: guessDigits
        }));
      } catch(e) {}
    }

    function generateNumber() {
      var digits = [0,1,2,3,4,5,6,7,8,9];
      var first = digits.splice(Math.floor(Math.random() * 9) + 1, 1)[0];
      var rest = [];
      for (var i = 0; i < 4; i++) {
        var idx = Math.floor(Math.random() * digits.length);
        rest.push(digits.splice(idx, 1)[0]);
      }
      return [first].concat(rest);
    }

    function evaluate(sec, guess) {
      var exact = 0, misplaced = 0;
      guess.forEach(function(d, i) {
        if (d === sec[i]) exact++;
        else if (sec.includes(d)) misplaced++;
      });
      return { exact: exact, misplaced: misplaced };
    }

    // Build per-digit colour map: green if exact, orange if misplaced, grey if wrong
    function evaluatePerDigit(sec, guess) {
      return guess.map(function(d, i) {
        if (d === sec[i]) return 'exact';
        if (sec.includes(d)) return 'misplaced';
        return 'wrong';
      });
    }

    function buildShareText() {
      var allGuesses = [];
      if (freeGuess) allGuesses.push(freeGuess);
      guesses.forEach(function(g) { allGuesses.push(g); });

      var lines = allGuesses.map(function(g) {
        var colours = evaluatePerDigit(secret, g.guess);
        return colours.map(function(c) {
          if (c === 'exact') return 'ðŸŸ©';
          if (c === 'misplaced') return 'ðŸŸ§';
          return 'â¬œ';
        }).join('');
      });

      var header = 'ðŸ”¢ Fiftle';
      if (won) {
        header += ' â€” cracked it in ' + guesses.length + ' guess' + (guesses.length > 1 ? 'es' : '') + '!';
      } else {
        header += ' â€” gave up ðŸ˜”';
      }

      return header + '\n\n' + lines.join('\n') + '\n\nPlay at fiftle.xyz';
    }

    function shareWhatsApp() {
      var text = buildShareText();
      var url = 'https://wa.me/?text=' + encodeURIComponent(text);
      window.open(url, '_blank');
    }

    function copyResult() {
      var text = buildShareText();
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(function() {
          var btn = document.getElementById('btn-copy');
          if (btn) { btn.textContent = 'Copied!'; setTimeout(function() { btn.textContent = 'ðŸ“‹ Copy'; }, 1500); }
        });
      }
    }

    function renderStats() {
      var total = completedGames.length;
      var avg = total > 0 ? (completedGames.reduce(function(a,b){ return a+b; }, 0) / total).toFixed(1) : "\u2014";
      var best = total > 0 ? Math.min.apply(null, completedGames) : "\u2014";
      var html =
        '<div class="stat-card"><div class="val">' + total + '</div><div class="lbl">Games Won</div></div>' +
        '<div class="stat-card"><div class="val">' + avg + '</div><div class="lbl">Avg Guesses</div></div>' +
        '<div class="stat-card"><div class="val">' + best + '</div><div class="lbl">Best</div></div>';
      if (!gameOver) {
        html += '<div class="stat-card"><div class="val">' + guesses.length + '</div><div class="lbl">Current</div><div class="sub-text">guesses</div></div>';
      }
      document.getElementById("stats-bar").innerHTML = html;
    }

    function renderInputs() {
      var row = document.getElementById("digit-row");
      row.innerHTML = "";
      for (var i = 0; i < 5; i++) {
        var inp = document.createElement("input");
        inp.type = "text";
        inp.inputMode = "numeric";
        inp.maxLength = 1;
        inp.className = "digit-input";
        inp.disabled = gameOver;
        inp.dataset.idx = i;
        inp.addEventListener("input", onDigitInput);
        inp.addEventListener("keydown", onDigitKeyDown);
        row.appendChild(inp);
      }
    }

    function renderButtons() {
      var row = document.getElementById("btn-row");
      var html = "";
      if (!gameOver) {
        html += '<button class="btn-guess" onclick="submitGuess()">Guess</button>';
        if (guesses.length > 0) {
          html += '<button class="btn-giveup" onclick="giveUp()">Give Up</button>';
        }
      } else {
        html += '<button class="btn-guess" disabled>Guess</button>';
        html += '<button class="btn-new" onclick="newGame()">New Game</button>';
      }
      row.innerHTML = html;
    }

    function renderBanner() {
      var container = document.getElementById("banner-container");
      if (!gameOver) { container.innerHTML = ""; return; }
      var total = completedGames.length;
      var avg = total > 0 ? (completedGames.reduce(function(a,b){ return a+b; }, 0) / total).toFixed(1) : null;

      var shareButtons = '<div class="banner-actions">' +
        '<button class="btn-share" onclick="shareWhatsApp()"><svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg> WhatsApp</button>' +
        '<button class="btn-new" id="btn-copy" onclick="copyResult()" style="font-size:14px;">ðŸ“‹ Copy</button>' +
        '</div>';

      if (won) {
        var sub = "";
        if (total > 1) sub = '<div class="banner-sub">Session average: ' + avg + ' guesses over ' + total + ' game' + (total > 1 ? 's' : '') + '</div>';
        container.innerHTML = '<div class="banner win"><div class="banner-emoji">ðŸŽ‰</div><div class="banner-text">Cracked it in ' + guesses.length + ' guess' + (guesses.length > 1 ? 'es' : '') + '!</div>' + sub + shareButtons + '</div>';
      } else {
        container.innerHTML = '<div class="banner lose"><div class="banner-emoji">ðŸ˜”</div><div class="banner-text">The number was ' + secret.join("") + '</div>' + shareButtons + '</div>';
      }
    }

    function makeGuessRowHTML(guess, result, index, isFreebie) {
      var cls = "guess-row";
      if (isFreebie) cls += " freebie";
      if (result.exact === 5) cls += " winner";
      var label = isFreebie ? "free" : "#" + index;
      var digitsHTML = guess.map(function(d) { return '<span class="guess-digit">' + d + '</span>'; }).join("");
      return '<div class="' + cls + '">' +
        '<div class="guess-left">' +
          '<span class="guess-idx">' + label + '</span>' +
          '<div class="guess-digits">' + digitsHTML + '</div>' +
        '</div>' +
        '<div class="guess-right">' +
          '<span class="badge exact">âœ… ' + result.exact + '</span>' +
          '<span class="badge misplaced">' + SQUIGGLE_SVG + ' ' + result.misplaced + '</span>' +
        '</div>' +
      '</div>';
    }

    function renderGuessList() {
      var list = document.getElementById("guess-list");
      var html = "";
      if (freeGuess) html += makeGuessRowHTML(freeGuess.guess, freeGuess.result, 0, true);
      guesses.forEach(function(g, i) {
        html += makeGuessRowHTML(g.guess, g.result, i + 1, false);
      });
      list.innerHTML = html;
      list.scrollTop = list.scrollHeight;
    }

    function render() {
      renderStats();
      renderButtons();
      renderBanner();
      renderGuessList();
    }

    function getDigitInputs() { return document.querySelectorAll(".digit-input"); }

    function onDigitInput(e) {
      var inp = e.target;
      var idx = parseInt(inp.dataset.idx);
      inp.value = inp.value.replace(/\D/g, "").slice(-1);
      if (inp.value && idx < 4) getDigitInputs()[idx + 1].focus();
    }

    function onDigitKeyDown(e) {
      var idx = parseInt(e.target.dataset.idx);
      var inputs = getDigitInputs();
      if (e.key === "Backspace" && !e.target.value && idx > 0) inputs[idx - 1].focus();
      if (e.key === "Enter") submitGuess();
      if (e.key === "ArrowLeft" && idx > 0) inputs[idx - 1].focus();
      if (e.key === "ArrowRight" && idx < 4) inputs[idx + 1].focus();
    }

    function clearInputs() {
      getDigitInputs().forEach(function(inp) { inp.value = ""; });
      getDigitInputs()[0].focus();
    }

    function shakeInput() {
      var area = document.getElementById("input-area");
      area.classList.add("shake");
      setTimeout(function() { area.classList.remove("shake"); }, 500);
    }

    function submitGuess() {
      if (gameOver) return;
      var vals = Array.from(getDigitInputs()).map(function(inp) { return inp.value; });
      if (vals.some(function(v) { return v === ""; })) { shakeInput(); return; }
      var guess = vals.map(Number);
      if (new Set(guess).size !== 5) { shakeInput(); return; }

      var result = evaluate(secret, guess);
      guesses.push({ guess: guess, result: result });

      if (result.exact === 5) {
        won = true;
        gameOver = true;
        completedGames.push(guesses.length);
      }

      render();
      if (!gameOver) clearInputs();
    }

    function giveUp() {
      gameOver = true;
      won = false;
      render();
    }

    function newGame() {
      secret = generateNumber();
      guesses = [];
      gameOver = false;
      won = false;

      var daily = loadDailyFreeGuess();
      if (daily.used) {
        freeGuess = { guess: daily.guess, result: evaluate(secret, daily.guess) };
      } else {
        var fg = generateNumber();
        saveDailyFreeGuess(fg);
        freeGuess = { guess: fg, result: evaluate(secret, fg) };
      }

      renderInputs();
      render();
      setTimeout(function() { getDigitInputs()[0].focus(); }, 50);
    }

    newGame();
  </script>
</body>
</html>
```
